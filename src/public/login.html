<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- ä¿®æ”¹ favicon ä¸º base64 å›¾æ ‡ -->
    <link rel="icon" href="./image/logo.png" type="image/png" />
    <title>é£ç‰›å½±è§†</title>
    <style>
        body {
            background: url("./image/bg-login.webp") no-repeat center center fixed;
            background-size: cover;
            /* æ‹‰ä¼¸é“ºæ»¡æ•´ä¸ªé¡µé¢ */
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC',
                'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial,
                sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #fff;
        }

        .login-container {
            width: 380px;
            background: rgba(37, 43, 55, 0.5);
            /* åŠé€æ˜èƒŒæ™¯ */
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);

            backdrop-filter: blur(12px);
            /* æ¯›ç»ç’ƒæ¨¡ç³Šæ•ˆæœ */
            -webkit-backdrop-filter: blur(12px);
            /* å…¼å®¹ Safari */
            border: 1px solid rgba(255, 255, 255, 0.2);
            /* è½»å¾®è¾¹æ¡†ï¼Œå¢å¼ºè´¨æ„Ÿ */
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .logo img {
            width: 120px;
            height: auto;
        }

        .logo-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .code-by {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            font-style: italic;
            white-space: nowrap;
        }

        .github-link {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            white-space: nowrap;
        }

        .github-link:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            text-decoration: none;
        }

        /* åœ¨å°å±å¹•ä¸Šå‚ç›´æ’åˆ— */
        @media (max-width: 400px) {
            .logo-info {
                flex-direction: column;
                gap: 8px;
            }
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        input[type='text'],
        input[type='password'] {
            width: 100%;
            padding: 12px 16px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(47, 53, 66, 0.4);
            /* åŠé€æ˜è¾“å…¥æ¡† */
            backdrop-filter: blur(6px);
            color: #fff;
            box-sizing: border-box;
            font-size: 14px;
        }

        input[type='text']:focus,
        input[type='password']:focus {
            outline: none;
            border-color: #3370ff;
        }

        .switch-container {
            display: flex;
            align-items: center;
            margin-bottom: 24px;
        }

        .switch-label {
            margin-left: 10px;
            font-size: 14px;
        }

        /* å¼€å…³æ ·å¼ */
        .switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #3c4250;
            transition: 0.4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: '';
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: #3370ff;
        }

        input:checked+.slider:before {
            transform: translateX(20px);
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background-color: #3370ff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: not-allowed;
            opacity: 0.6;
            transition: background-color 0.2s, opacity 0.2s, cursor 0.2s;
        }

        .login-btn.enabled {
            cursor: pointer;
            opacity: 1;
        }

        .login-btn.enabled:hover {
            background-color: #2856c4;
        }

        input.error {
            border: 1px solid red !important;
            /* è¾“å…¥æ¡†çº¢è‰²è¾¹æ¡† */
        }

        .error-msg {
            color: red;
            /* æç¤ºæ–‡å­—çº¢è‰² */
            font-size: 12px;
            /* å°å­—ä½“ */
            margin-top: 5px;
            /* ä¸Šæ–¹é—´è· */
        }

        input[type="text"],
        input[type="password"] {
            -webkit-user-modify: read-write-plaintext-only;
            /* å–æ¶ˆæ‹¼å†™æ³¢æµªçº¿ */
        }

        /* ç¦æ­¢æ‰€æœ‰å…ƒç´ æ‹–æ‹½ */
        * {
            -webkit-user-drag: none;
            -khtml-user-drag: none;
            -moz-user-drag: none;
            -o-user-drag: none;
        }

        /* ç‰¹åˆ«é’ˆå¯¹å›¾ç‰‡ç¦æ­¢æ‹–æ‹½å’Œé€‰ä¸­ */
        img {
            -webkit-user-drag: none;
            -khtml-user-drag: none;
            -moz-user-drag: none;
            -o-user-drag: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* Logoå›¾ç‰‡å®Œå…¨ç¦æ­¢äº¤äº’ */
        .logo img {
            pointer-events: none;
        }

        /* å¯†ç æ˜¾ç¤ºæŒ‰é’® */
        .password-toggle {
            position: absolute;
            right: 12px;
            top: 46px; /* ç²¾ç¡®è®¡ç®—ï¼šlabel(18px) + margin(8px) + border(1px) + padding(12px) + æ–‡æœ¬ä¸­å¿ƒ(7px) */
            transform: translateY(-50%);
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            font-size: 16px;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .password-toggle:hover {
            color: rgba(255, 255, 255, 0.9);
            background: rgba(255, 255, 255, 0.1);
        }

        /* å†å²è®°å½•æŒ‰é’® */
        .history-btn {
            position: absolute;
            right: 12px;
            top: 46px; /* ç²¾ç¡®è®¡ç®—ï¼šlabel(18px) + margin(8px) + border(1px) + padding(12px) + æ–‡æœ¬ä¸­å¿ƒ(7px) */
            transform: translateY(-50%);
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            font-size: 16px;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .history-btn:hover {
            color: rgba(255, 255, 255, 0.9);
            background: rgba(255, 255, 255, 0.1);
        }

        /* å†å²è®°å½•ä¸‹æ‹‰æ¡† */
        .history-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            left: 0;
            background: rgba(37, 43, 55, 0.95);
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-height: 240px;
            margin-top: 4px;
            overflow-y: auto;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-10px);
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .history-dropdown.show {
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
        }

        .history-item {
            padding: 12px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: background-color 0.2s;
            position: relative;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-item:hover {
            background-color: rgba(51, 112, 255, 0.2);
        }

        .history-content {
            flex: 1;
            cursor: pointer;
        }

        .history-delete {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.4);
            cursor: pointer;
            font-size: 14px;
            padding: 4px 6px;
            border-radius: 3px;
            transition: all 0.2s;
            margin-left: 8px;
            opacity: 0;
            transform: scale(0.8);
        }

        .history-item:hover .history-delete {
            opacity: 1;
            transform: scale(1);
        }

        .history-delete:hover {
            color: #ff4757;
            background: rgba(255, 71, 87, 0.1);
        }

        .history-account {
            font-size: 14px;
            font-weight: 500;
            color: #fff;
            margin-bottom: 4px;
        }

        .history-domain {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .no-history {
            padding: 16px;
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
        }

        .clear-history {
            padding: 8px 16px;
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .clear-history:hover {
            background-color: rgba(255, 0, 0, 0.2);
            color: rgba(255, 255, 255, 0.9);
        }

        /* ä¸ºäº†ç»™æŒ‰é’®ç•™å‡ºç©ºé—´ï¼Œè°ƒæ•´inputçš„å³padding */
        .form-group.has-button input {
            padding-right: 40px;
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        .history-dropdown::-webkit-scrollbar {
            width: 6px;
        }

        .history-dropdown::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .history-dropdown::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        .history-dropdown::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡† */
        .custom-confirm {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .custom-confirm.show {
            opacity: 1;
            visibility: visible;
        }

        .confirm-dialog {
            background: rgba(37, 43, 55, 0.95);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: 300px;
            max-width: 400px;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .custom-confirm.show .confirm-dialog {
            transform: scale(1);
        }

        .confirm-title {
            font-size: 16px;
            font-weight: 500;
            color: #fff;
            margin-bottom: 16px;
        }

        .confirm-message {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .confirm-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .confirm-btn {
            padding: 8px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .confirm-btn.cancel {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
        }

        .confirm-btn.cancel:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }

        .confirm-btn.confirm {
            background: #ff4757;
            color: #fff;
        }

        .confirm-btn.confirm:hover {
            background: #ff3838;
        }

        /* è‡ªå®šä¹‰æ¶ˆæ¯å¼¹çª— */
        .custom-message {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .custom-message.show {
            opacity: 1;
            visibility: visible;
        }

        .message-dialog {
            background: rgba(37, 43, 55, 0.95);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: 300px;
            max-width: 400px;
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .custom-message.show .message-dialog {
            transform: scale(1);
        }

        .message-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            position: relative;
        }

        .message-icon.error {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 107, 107, 0.5);
            color: #ff6b6b;
            box-shadow: none;
        }

        .message-icon.success {
            background: linear-gradient(135deg, #2ed573, #26d0ce);
            color: #fff;
            box-shadow: 0 4px 15px rgba(46, 213, 115, 0.3);
        }

        .message-icon.warning {
            background: linear-gradient(135deg, #ffa502, #ff6348);
            color: #fff;
            box-shadow: 0 4px 15px rgba(255, 165, 2, 0.3);
        }

        .message-icon.info {
            background: linear-gradient(135deg, #3370ff, #2856c4);
            color: #fff;
            box-shadow: 0 4px 15px rgba(51, 112, 255, 0.3);
        }

        .message-title {
            font-size: 20px;
            font-weight: 600;
            color: #fff;
            margin-bottom: 8px;
        }

        .message-dialog.error .message-title {
            color: rgba(255, 255, 255, 0.9);
        }

        .message-content {
            color: rgba(255, 255, 255, 0.85);
            margin-bottom: 28px;
            line-height: 1.6;
            font-size: 15px;
        }

        .message-button {
            padding: 12px 32px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #3370ff, #2856c4);
            color: #fff;
            min-width: 100px;
            box-shadow: 0 4px 15px rgba(51, 112, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .message-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(51, 112, 255, 0.4);
        }

        .message-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(51, 112, 255, 0.3);
        }
    </style>
</head>

<body>
    <div class="login-container">
        <div class="logo">
            <!-- ä¿®æ”¹ logo å›¾æ ‡ä¸º base64 -->
            <img src="./image/logo.png" alt="é£ç‰›å½±è§†" />
            <div class="logo-info">
                <span class="code-by">code by Tag mig hÃ¥nden</span>
                <a href="https://github.com/QiaoKes/fntv-electron" class="github-link" target="_blank" rel="noopener noreferrer">githubåœ°å€</a>
            </div>
        </div>
        <div class="form-group has-button">
            <label for="domain">åŸŸå/IPåœ°å€</label>
            <input type="text" id="domain" placeholder="è¯·è¾“å…¥æœåŠ¡å™¨åŸŸåæˆ–IPåœ°å€" spellcheck="false" tabindex="1" />
            <button type="button" class="history-btn" id="historyBtn" title="é€‰æ‹©å†å²è®°å½•">ğŸ“</button>
            <div class="history-dropdown" id="historyDropdown">
                <div class="no-history">æš‚æ— å†å²è®°å½•</div>
            </div>
            <div id="domainError" class="error-msg" style="display:none;">è¯·æ­£ç¡®å¡«å†™IPV4ã€IPV6æˆ–è€…åŸŸå</div>
        </div>
        <div class="form-group">
            <label for="username">ç”¨æˆ·å</label>
            <input type="text" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" spellcheck="false" tabindex="2" />
        </div>
        <div class="form-group has-button">
            <label for="password">å¯†ç </label>
            <input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç " spellcheck="false" tabindex="3" />
            <button type="button" class="password-toggle" id="passwordToggle" title="æ˜¾ç¤º/éšè—å¯†ç ">ğŸ‘</button>
        </div>
        <div class="switch-container">
            <label class="switch">
                <input type="checkbox" id="httpsSwitch" />
                <span class="slider"></span>
            </label>
            <span class="switch-label">HTTPSå®‰å…¨è®¿é—®</span>
        </div>
        <button class="login-btn" id="loginBtn" disabled>ç™»å½•</button>
    </div>

    <!-- è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡† -->
    <div class="custom-confirm" id="customConfirm">
        <div class="confirm-dialog">
            <div class="confirm-title">ç¡®è®¤æ“ä½œ</div>
            <div class="confirm-message" id="confirmMessage">ç¡®å®šè¦æ‰§è¡Œæ­¤æ“ä½œå—ï¼Ÿ</div>
            <div class="confirm-buttons">
                <button class="confirm-btn cancel" id="confirmCancel">å–æ¶ˆ</button>
                <button class="confirm-btn confirm" id="confirmOk">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <!-- è‡ªå®šä¹‰æ¶ˆæ¯å¼¹çª— -->
    <div class="custom-message" id="customMessage">
        <div class="message-dialog">
            <div class="message-icon" id="messageIcon">â„¹ï¸</div>
            <div class="message-title" id="messageTitle">æç¤º</div>
            <div class="message-content" id="messageContent">è¿™é‡Œæ˜¯æ¶ˆæ¯å†…å®¹</div>
            <button class="message-button" id="messageButton">ç¡®å®š</button>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron'); // æ¸²æŸ“è¿›ç¨‹å¯ç”¨
        const loginBtn = document.getElementById('loginBtn');
        const domainInput = document.getElementById('domain');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const passwordToggle = document.getElementById('passwordToggle');
        const historyBtn = document.getElementById('historyBtn');
        const historyDropdown = document.getElementById('historyDropdown');
        const customConfirm = document.getElementById('customConfirm');
        const confirmMessage = document.getElementById('confirmMessage');
        const confirmCancel = document.getElementById('confirmCancel');
        const confirmOk = document.getElementById('confirmOk');
        const customMessage = document.getElementById('customMessage');
        const messageIcon = document.getElementById('messageIcon');
        const messageTitle = document.getElementById('messageTitle');
        const messageContent = document.getElementById('messageContent');
        const messageButton = document.getElementById('messageButton');
        
        let historyData = [];
        let confirmCallback = null;

        // è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†å‡½æ•°
        function showCustomConfirm(message, callback) {
            confirmMessage.textContent = message;
            confirmCallback = callback;
            customConfirm.classList.add('show');
        }

        function hideCustomConfirm() {
            customConfirm.classList.remove('show');
            confirmCallback = null;
            // å¯¹è¯æ¡†å…³é—­åç«‹å³æ¢å¤ç„¦ç‚¹
            setTimeout(() => {
                domainInput.focus();
            }, 100);
        }

        // ç¡®è®¤å¯¹è¯æ¡†äº‹ä»¶ç›‘å¬
        confirmCancel.addEventListener('click', () => {
            hideCustomConfirm();
        });

        confirmOk.addEventListener('click', () => {
            if (confirmCallback) {
                confirmCallback();
            }
            hideCustomConfirm();
        });

        // ç‚¹å‡»å¯¹è¯æ¡†å¤–éƒ¨åŒºåŸŸå…³é—­
        customConfirm.addEventListener('click', (e) => {
            if (e.target === customConfirm) {
                hideCustomConfirm();
            }
        });

        // ESCé”®å…³é—­å¯¹è¯æ¡†
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && customConfirm.classList.contains('show')) {
                hideCustomConfirm();
            }
            if (e.key === 'Escape' && customMessage.classList.contains('show')) {
                hideCustomMessage();
            }
        });

        // è‡ªå®šä¹‰æ¶ˆæ¯å¼¹çª—å‡½æ•°
        function showCustomMessage(type, title, content) {
            // æ¸…é™¤ä¹‹å‰çš„ç±»å‹ç±»
            const messageDialog = document.querySelector('.message-dialog');
            messageDialog.classList.remove('error', 'success', 'warning', 'info');
            
            // æ·»åŠ å½“å‰ç±»å‹ç±»
            messageDialog.classList.add(type);
            
            // è®¾ç½®å›¾æ ‡å’Œæ ·å¼
            messageIcon.className = `message-icon ${type}`;
            
            // å¯¹äºé”™è¯¯ç±»å‹ï¼Œéšè—å›¾æ ‡ä»¥å‡å°‘è§†è§‰å†²å‡»
            if (type === 'error') {
                messageIcon.style.display = 'none';
            } else {
                messageIcon.style.display = 'flex';
                switch(type) {
                    case 'success':
                        messageIcon.textContent = 'âœ“';
                        break;
                    case 'warning':
                        messageIcon.textContent = '!';
                        break;
                    case 'info':
                    default:
                        messageIcon.textContent = 'i';
                        break;
                }
            }
            
            messageTitle.textContent = title;
            messageContent.textContent = content;
            customMessage.classList.add('show');
        }

        function hideCustomMessage() {
            customMessage.classList.remove('show');
            // æ¶ˆæ¯å¼¹çª—å…³é—­åæ¢å¤ç„¦ç‚¹
            setTimeout(() => {
                domainInput.focus();
            }, 100);
        }

        // æ¶ˆæ¯å¼¹çª—äº‹ä»¶ç›‘å¬
        messageButton.addEventListener('click', () => {
            hideCustomMessage();
        });

        // ç‚¹å‡»æ¶ˆæ¯å¼¹çª—å¤–éƒ¨åŒºåŸŸå…³é—­
        customMessage.addEventListener('click', (e) => {
            if (e.target === customMessage) {
                hideCustomMessage();
            }
        });

        // å¼ºåˆ¶æ¢å¤ç„¦ç‚¹çš„é€šç”¨å‡½æ•°
        function restoreFocus() {
            try {
                // ç¡®ä¿è¾“å…¥æ¡†å¯ç”¨
                domainInput.disabled = false;
                domainInput.readOnly = false;
                
                // å¤šç§æ–¹å¼å°è¯•æ¢å¤ç„¦ç‚¹
                domainInput.focus();
                domainInput.select();
                
                // å¦‚æœè¿˜æ˜¯æ— æ³•è·å–ç„¦ç‚¹ï¼Œå°è¯•ç‚¹å‡»
                const clickEvent = new MouseEvent('click', {
                    view: window,
                    bubbles: true,
                    cancelable: true
                });
                domainInput.dispatchEvent(clickEvent);
                
                // å¼ºåˆ¶è®¾ç½®å…‰æ ‡ä½ç½®
                if (domainInput.setSelectionRange) {
                    const len = domainInput.value.length;
                    domainInput.setSelectionRange(len, len);
                }
            } catch (error) {
                console.error('æ¢å¤ç„¦ç‚¹å¤±è´¥:', error);
            }
        }

        function isValidDomainOrIP(value) {
            const domainRegex = /^([\u4e00-\u9fa5a-zA-Z0-9-]+\.)+[\u4e00-\u9fa5a-zA-Z]{2,}(:\d+)?$/;
            const ipv4Regex = /^(25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)){3}(:\d+)?$/;
            const ipv6Regex = /^\[((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\](:\d+)?$/;
            return domainRegex.test(value) || ipv4Regex.test(value) || ipv6Regex.test(value);
        }

        function checkInputs() {
            const domain = domainInput.value.trim();
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();
            const domainError = document.getElementById('domainError');

            if (domain && isValidDomainOrIP(domain) && username && password) {
                loginBtn.disabled = false;
                loginBtn.classList.add('enabled');
            } else {
                loginBtn.disabled = true;
                loginBtn.classList.remove('enabled');
            }
        }

        // å¤±å»ç„¦ç‚¹æ—¶æ˜¾ç¤ºçº¢è‰²æç¤º
        domainInput.addEventListener('blur', function () {
            const domain = domainInput.value.trim();
            if (domain && !isValidDomainOrIP(domain)) {
                domainInput.classList.add('error');
                domainError.style.display = 'block';
            } else {
                domainInput.classList.remove('error');
                domainError.style.display = 'none';
            }
        });

        domainInput.addEventListener('input', checkInputs);
        usernameInput.addEventListener('input', checkInputs);
        passwordInput.addEventListener('input', checkInputs);

        // ç™»å½•é€»è¾‘
        loginBtn.addEventListener('click', function () {
            if (loginBtn.disabled) return;
            
            // è®¾ç½®ç™»å½•ä¸­çŠ¶æ€
            const originalText = loginBtn.textContent;
            loginBtn.textContent = 'ç™»å½•ä¸­...';
            loginBtn.disabled = true;
            loginBtn.classList.remove('enabled');
            
            const domain = domainInput.value.trim();
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();
            const useHttps = document.getElementById('httpsSwitch').checked;

            console.log('ç™»å½•ä¿¡æ¯:', { domain, username, password, useHttps });
            
            const loginData = {
                domain: domain,
                username: username,
                password: password,
                useHttps: useHttps
            };

            // å‘é€ç™»å½•è¯·æ±‚
            ipcRenderer.send('login', loginData);
            
            // 5ç§’åæ¢å¤æŒ‰é’®çŠ¶æ€ï¼ˆé˜²æ­¢æ— å“åº”ï¼‰
            const timeoutId = setTimeout(() => {
                loginBtn.textContent = originalText;
                checkInputs(); // é‡æ–°æ£€æŸ¥è¾“å…¥çŠ¶æ€
            }, 5000);
            
            // ç›‘å¬ç™»å½•ç»“æœï¼Œæ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥éƒ½æ¢å¤æŒ‰é’®çŠ¶æ€
            const handleLoginResult = () => {
                clearTimeout(timeoutId);
                loginBtn.textContent = originalText;
                checkInputs();
            };
            
            // ä¸´æ—¶ç›‘å¬å™¨ï¼Œå¤„ç†å®Œåè‡ªåŠ¨ç§»é™¤
            const tempErrorListener = () => {
                handleLoginResult();
                ipcRenderer.off('login-error', tempErrorListener);
            };
            
            const tempSuccessListener = () => {
                handleLoginResult();
                ipcRenderer.off('login-success', tempSuccessListener);
            };
            
            ipcRenderer.once('login-error', tempErrorListener);
            ipcRenderer.once('login-success', tempSuccessListener);
        });

        // Enter é”®è§¦å‘
        document.addEventListener('keypress', function (e) {
            if (e.key === 'Enter' && !loginBtn.disabled) {
                loginBtn.click();
            }
        });

        // å¯†ç æ˜¾ç¤º/éšè—åˆ‡æ¢
        passwordToggle.addEventListener('click', function () {
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                passwordToggle.textContent = 'ğŸ™ˆ';
                passwordToggle.title = 'éšè—å¯†ç ';
            } else {
                passwordInput.type = 'password';
                passwordToggle.textContent = 'ğŸ‘';
                passwordToggle.title = 'æ˜¾ç¤ºå¯†ç ';
            }
        });

        // å†å²è®°å½•æŒ‰é’®ç‚¹å‡»
        historyBtn.addEventListener('click', function (e) {
            e.stopPropagation();
            historyDropdown.classList.toggle('show');
        });

        // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­å†å²è®°å½•ä¸‹æ‹‰æ¡†
        document.addEventListener('click', function (e) {
            if (!historyDropdown.contains(e.target) && e.target !== historyBtn) {
                historyDropdown.classList.remove('show');
            }
        });

        // æ¸²æŸ“å†å²è®°å½•åˆ—è¡¨
        function renderHistoryList() {
            if (!historyData || historyData.length === 0) {
                historyDropdown.innerHTML = '<div class="no-history">æš‚æ— å†å²è®°å½•</div>';
                return;
            }

            const historyHtml = historyData.map((item, index) => `
                <div class="history-item" data-domain="${item.domain}" data-account="${item.account}" data-password="${item.password}" data-use-https="${item.useHttps || false}" data-index="${index}">
                    <div class="history-content">
                        <div class="history-account">${item.account}</div>
                        <div class="history-domain">${item.domain}${item.useHttps ? ' (HTTPS)' : ' (HTTP)'}</div>
                    </div>
                    <button class="history-delete" data-index="${index}" title="åˆ é™¤æ­¤è®°å½•">Ã—</button>
                </div>
            `).join('');

            const clearButton = historyData.length > 0 ? '<div class="clear-history" id="clearHistoryBtn">æ¸…é™¤æ‰€æœ‰å†å²è®°å½•</div>' : '';
            historyDropdown.innerHTML = historyHtml + clearButton;

            // ä¸ºå†å²è®°å½•é¡¹æ·»åŠ ç‚¹å‡»äº‹ä»¶
            historyDropdown.querySelectorAll('.history-content').forEach(content => {
                content.addEventListener('click', function () {
                    const item = this.parentNode;
                    const domain = item.dataset.domain;
                    const account = item.dataset.account;
                    const password = item.dataset.password;
                    const useHttps = item.dataset.useHttps === 'true';

                    domainInput.value = domain;
                    usernameInput.value = account;
                    passwordInput.value = password;
                    document.getElementById('httpsSwitch').checked = useHttps;

                    // å…³é—­ä¸‹æ‹‰æ¡†
                    historyDropdown.classList.remove('show');
                    
                    // æ£€æŸ¥è¾“å…¥çŠ¶æ€
                    checkInputs();
                });
            });

            // ä¸ºåˆ é™¤æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
            historyDropdown.querySelectorAll('.history-delete').forEach(deleteBtn => {
                deleteBtn.addEventListener('click', function (e) {
                    e.stopPropagation(); // é˜²æ­¢è§¦å‘çˆ¶å…ƒç´ çš„ç‚¹å‡»äº‹ä»¶
                    e.preventDefault(); // é˜²æ­¢é»˜è®¤è¡Œä¸º
                    
                    const index = parseInt(this.dataset.index);
                    const item = historyData[index];
                    
                    // ç«‹å³å…³é—­ä¸‹æ‹‰æ¡†
                    historyDropdown.classList.remove('show');
                    
                    // ä½¿ç”¨è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†
                    showCustomConfirm(
                        `ç¡®å®šè¦åˆ é™¤ ${item.account}@${item.domain} çš„ç™»å½•è®°å½•å—ï¼Ÿ`,
                        () => {
                            // å‘é€åˆ é™¤å•ä¸ªå†å²è®°å½•çš„è¯·æ±‚
                            ipcRenderer.send('delete-history-item', { domain: item.domain, account: item.account });
                        }
                    );
                });
            });

            // æ¸…é™¤å†å²è®°å½•æŒ‰é’®äº‹ä»¶
            const clearBtn = document.getElementById('clearHistoryBtn');
            if (clearBtn) {
                clearBtn.addEventListener('click', function (e) {
                    e.stopPropagation();
                    e.preventDefault();
                    
                    // ç«‹å³å…³é—­ä¸‹æ‹‰æ¡†
                    historyDropdown.classList.remove('show');
                    
                    // ä½¿ç”¨è‡ªå®šä¹‰ç¡®è®¤å¯¹è¯æ¡†
                    showCustomConfirm(
                        'ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å†å²è®°å½•å—ï¼Ÿ',
                        () => {
                            ipcRenderer.send('clear-history');
                            historyData = [];
                            renderHistoryList();
                        }
                    );
                });
            }
        }

        // åŠ è½½é…ç½®å’Œå†å²è®°å½•
        function loadConfigData() {
            ipcRenderer.send('get-config');
        }

        // ç›‘å¬é…ç½®æ•°æ®è¿”å›
        ipcRenderer.on('config-data', (event, data) => {
            const { config, history } = data;
            historyData = history || [];
            
            // å¦‚æœæœ‰å½“å‰é…ç½®ï¼Œå¡«å……åˆ°è¡¨å•ä¸­
            if (config && config.domain) {
                // å»é™¤æ‰http://å’Œhttps://
                domainInput.value = config.domain.replace(/^https?:\/\//, '');
                // æ ¹æ®ä¿å­˜çš„useHttpsè®¾ç½®å¤é€‰æ¡†çŠ¶æ€
                if (config.useHttps) {
                    document.getElementById('httpsSwitch').checked = config.useHttps;
                }
            }
            if (config && config.account) {
                usernameInput.value = config.account;
            }
            
            // æ¸²æŸ“å†å²è®°å½•
            renderHistoryList();
            
            // æ£€æŸ¥è¾“å…¥çŠ¶æ€
            checkInputs();
        });

        // ç›‘å¬å†å²è®°å½•åˆ é™¤æˆåŠŸ
        ipcRenderer.on('history-item-deleted', (event, data) => {
            // é‡æ–°åŠ è½½é…ç½®æ•°æ®
            loadConfigData();
        });

        // ç›‘å¬ç™»å½•é”™è¯¯æ¶ˆæ¯
        ipcRenderer.on('login-error', (event, data) => {
            const { title, message } = data;
            showCustomMessage('error', title, message);
        });

        // ç›‘å¬ç™»å½•æˆåŠŸæ¶ˆæ¯
        ipcRenderer.on('login-success', (event, data) => {
            const { title, message } = data;
            showCustomMessage('success', title, message);
        });

        // æ·»åŠ é¢å¤–çš„ç„¦ç‚¹ç®¡ç†äº‹ä»¶ç›‘å¬å™¨
        document.addEventListener('click', function(e) {
            // å¦‚æœç‚¹å‡»çš„ä¸æ˜¯å†å²è®°å½•ç›¸å…³å…ƒç´ ï¼Œç¡®ä¿è¾“å…¥æ¡†å¯ä»¥æ­£å¸¸è·å–ç„¦ç‚¹
            if (!historyDropdown.contains(e.target) && 
                e.target !== historyBtn && 
                !e.target.classList.contains('history-delete') &&
                e.target.id !== 'clearHistoryBtn') {
                // å¦‚æœæ²¡æœ‰å…¶ä»–è¾“å…¥å…ƒç´ è·å¾—ç„¦ç‚¹ï¼Œé»˜è®¤èšç„¦åˆ°åŸŸåè¾“å…¥æ¡†
                setTimeout(() => {
                    if (!document.activeElement || 
                        (document.activeElement.tagName !== 'INPUT' && 
                         document.activeElement.tagName !== 'BUTTON')) {
                        domainInput.focus();
                    }
                }, 50);
            }
        });

        // ç›‘å¬çª—å£ç„¦ç‚¹äº‹ä»¶
        window.addEventListener('focus', function() {
            // å½“çª—å£é‡æ–°è·å¾—ç„¦ç‚¹æ—¶ï¼Œç¡®ä¿è¾“å…¥æ¡†å¯ä»¥æ­£å¸¸å·¥ä½œ
            setTimeout(restoreFocus, 100);
        });

        // GitHubé“¾æ¥ç‚¹å‡»äº‹ä»¶å¤„ç†
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('github-link')) {
                e.preventDefault(); // é˜»æ­¢é»˜è®¤è¡Œä¸º
                const url = e.target.href;
                // ä½¿ç”¨Electronçš„shellæ¨¡å—åœ¨å¤–éƒ¨æµè§ˆå™¨æ‰“å¼€é“¾æ¥
                const { shell } = require('electron');
                shell.openExternal(url);
            }
        });

        // ç¦æ­¢æ‹–æ‹½äº‹ä»¶
        document.addEventListener('dragstart', function(e) {
            e.preventDefault();
            return false;
        });

        // ç¦æ­¢æ‹–æ‹½æ•ˆæœ
        document.addEventListener('drag', function(e) {
            e.preventDefault();
            return false;
        });

        // ç¦æ­¢æ‹–æ‹½ç»“æŸ
        document.addEventListener('dragend', function(e) {
            e.preventDefault();
            return false;
        });

        // é¡µé¢åŠ è½½å®Œæˆåè¯»å–é…ç½®
        window.addEventListener('DOMContentLoaded', function () {
            loadConfigData();
            
            // ç¡®ä¿é¡µé¢åŠ è½½ååŸŸåè¾“å…¥æ¡†èƒ½å¤Ÿæ­£ç¡®è·å–ç„¦ç‚¹
            setTimeout(() => {
                domainInput.focus();
            }, 500);
        });
    </script>
</body>

</html>